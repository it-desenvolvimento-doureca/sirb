<!--<app-controlos (atualiza)="atualizar()"></app-controlos>-->
<div class="main-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <!--div class="card-header" data-background-color="red">
            <h4 class="title">Análise de Dívidas</h4>
            <p class="category"></p>
            <button type="button" pButton icon="fa-file" iconPos="left" label="Export" (click)="exportCSV()"
              style="float:right; top: -10px; position: absolute; right: 23px;"></button>
          </div-->
          <div class="card-content table-responsive">
            <!-- [rows]="25" [paginator]="true" [pageLinks]="3" [rowsPerPageOptions]="[25,50,100,'todos']"-->
            <div class="btn-pref btn-group-justified btn-group-lg" role="group" aria-label="...">

              <div class="btn-group" role="group" style="border-right: 2px solid white;">
                <button (click)="ativobt='1';" style="padding: 12px;" [class.ativobt]="ativobt == '1'" type="button"
                  id="stars" class="btn " href="#tab1" data-toggle="tab"><span class="glyphicon glyphicon-th"
                    aria-hidden="true"></span>
                  <div class="hidden-xs" style="display: contents;">Dashboard</div>
                </button>
              </div>
              <div class="btn-group" role="group" style="border-right: 2px solid white;">
                <button (click)="ativobt='2';" style="padding: 12px;" [class.ativobt]="ativobt == '2'" type="button"
                  id="favorites" class="btn" href="#tab2" data-toggle="tab"><span class="glyphicon glyphicon-th"
                    aria-hidden="true"></span>
                  <div class="hidden-xs" style="display: contents;">Análise</div>
                </button>
                <button type="button" pButton icon="fa-file" iconPos="left" label="Export" (click)="exportCSV()"
                  style="float:right; top: 8px; position: absolute; right: 23px; z-index: 2; box-shadow: 0px 1px 2px 1px black; background-color: #474849;"></button>
              </div>
            </div>
            <div class="well" style="display: flex; padding: 0;">
              <div class="tab-content" style="width: 100%; padding: 0;">
                <div class="tab-pane fade in active" id="tab1">
                  <div class="row" style="width: 100%; margin: 0;">
                    <div class="row" style="margin: 0;">
                      <div class="col-lg-3 col-md-3  col-sm-6">
                        <div class="card card-stats">
                          <div class="card-body ">
                            <div class="row">
                              <div class="col-md-12">
                                <div class="numbers">
                                  <p class="card-category">AGGREGATE AMOUNT</p>
                                  <p class="card-title">{{totaldivida | number: '1.2-2'}} €</p>
                                  <p>
                                  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-3 col-md-3  col-sm-6">
                        <div class="card card-stats">
                          <div class="card-body ">
                            <div class="row">
                              <div class="col-md-12">
                                <div class="numbers">
                                  <p class="card-category">TOTAL AMOUNT DUE</p>
                                  <p class="card-title">{{totaldividavenc | number: '1.2-2'}} €</p>
                                  <p>
                                  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-3 col-md-3  col-sm-6">
                        <div class="card card-stats">
                          <div class="card-body ">
                            <div class="row">
                              <div class="col-md-12">
                                <div class="numbers">
                                  <p class="card-category">AVERAGE DUE (DAYS) </p>
                                  <p class="card-title">{{average_due | number: '1.2-2'}} days</p>
                                  <p>
                                  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-3 col-md-3 col-sm-6">
                        <div class="card card-stats">
                          <div class="card-body ">
                            <div class="row">
                              <div class="col-md-12">
                                <div class="numbers">
                                  <p class="card-category">DEBT > 31 Days</p>
                                  <p class="card-title">{{total_dev | number: '1.0-0'}} %</p>
                                  <p>
                                  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="card" id="divgrafico"
                        style=" max-width: 100%; min-height: 100px; padding-left: 10px; padding-right: 10px;"
                        [style.height.px]="myInnerHeight2">
                        <!--h1
                          style="font-size: 17px; color: #666666; font-weight: 900; text-align: center; margin-top: 4px;">
                          AGE SUMMARY</h1>                        
                        <div id="chart_div" style="width: 100%; height:100%"></div-->
                        <p-chart type="pie" [data]="data" height="200" [options]="options_pie"></p-chart>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card" id="divgrafico" style=" max-width: 100%; min-height: 100px;"
                        [style.height.px]="myInnerHeight2">
                        <!--h1 style="font-size: 16px; color: gray; font-weight: 800; text-align: center;">AGE SUMMARY</h1>
                        <div id="chart_div_debs_due" style="width: 100%; height:100%"></div-->
                        <p-chart type="horizontalBar" [data]="data1" [options]="options2">
                        </p-chart>
                      </div>
                    </div>
                    <div class="col-md-12">
                      <div class="card" style=" max-width: 100%; min-height: 100px;" [style.height.px]="myInnerHeight"
                        id="divgrafico">
                        <p-chart type="horizontalBar" [options]="options3" [data]="data2">
                        </p-chart>
                        <!--h1
                          style="font-size: 17px; color: #666666; font-weight: 900; text-align: center; margin-top: 4px;">
                          TOP
                          15 CUSTOMERS BY AMOUNT DUE</h1>
                        <div id="chart_div_top15" style="width: 100%; "></div-->
                      </div>
                    </div>
                  </div>
                </div>
                <div class="tab-pane fade in" id="tab2">
                  <p-dataTable [emptyMessage]="mensagemtabela" [style]="{'min-height':'300px'}" [value]="tabela"
                    dataKey="n_cliente" class="tabela_analise_dividas cab_tabela_analise_dividas"
                    [(selection)]="clientes_seleccionados" (onFilter)="atualizatotais($event)"
                    (onRowSelect)="atualizatotais(null,true)" (onRowUnselect)="atualizatotais(null,true)"
                    (onSort)="atualizatotais($event)">

                    <p-header>
                      <tr style="width: 100%; display: table; height: 35px;">
                        <td style="width: 303px;"><a (click)="reset()"
                            style="color: white;float: left; cursor: pointer; margin-left: 19px;">
                            <i class="fa fa-eraser" aria-hidden="true"></i> Limpar Filtros
                            <div class="ripple-container"></div>
                          </a></td>
                        <td style="border-right: 1px solid; text-align: right; width: 90px;">
                          <span style="margin-right: 5px; font-weight: 700;">TOTAIS: </span>
                        </td>
                        <td style="border-right: 1px solid; width: 89px; text-align: center;">
                          {{totalprazopag | number: '1.0-0'}}</td>
                        <td style="border-right: 1px solid; width: 90px; text-align: center;">
                          {{totalprazoatraso | number: '1.0-0'}}</td>
                        <td style="border-right: 1px solid; width: 70px; text-align: right;">
                          {{totaldivida | number: '1.2-2'}}
                          €</td>
                        <td style="border-right: 1px solid; width: 93px; text-align: right;">
                          {{totaldividavenc | number: '1.2-2'}} €</td>
                        <td style="border-right: 1px solid; width: 73px; text-align: right;">
                          {{totalnaovencido | number: '1.2-2'}} €</td>
                        <td style="border-right: 1px solid; width: 70px; text-align: right;">
                          {{total31dias | number: '1.2-2'}}
                          €</td>
                        <td style="border-right: 1px solid; width: 70px; text-align: right;">
                          {{total3160dias | number: '1.2-2'}} €</td>
                        <td style="border-right: 1px solid; width: 70px; text-align: right;">
                          {{total6190dias | number: '1.2-2'}} €</td>
                        <td style="border-right: 1px solid; width: 70px; text-align: right;">
                          {{total91dias | number: '1.2-2'}} €</td>
                        <td style=" width: 70px;  text-align: right;">{{totalacordo | number: '1.2-2'}} €</td>
                      </tr>

                    </p-header>
                    <p-column [style]="{'width':'20px'}" selectionMode="multiple"></p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="kam" header="KAM"
                      [style]="{'width':'78px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="kam" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="n_cliente"
                      header="Nº CLIENTE   CUSTOMER NUMBER" [style]="{'width':'55px'}">
                      <ng-template let-col let-car="rowData" pTemplate="header">Nº CLIENTE <br> CUSTOMER NUMBER
                      </ng-template>
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="n_cliente" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <a style=" cursor:pointer;" title="Abrir Ficha" [routerLink]="['/analise_dividas/view']"
                          [queryParams]="{ id: car.n_cliente }"> {{car[col.field]}}</a>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="nome_cliente"
                      header="NOME CUSTOMER" [style]="{'width':'254px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="nome_cliente" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">NOME <br> CUSTOMER</ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: left; display: block; padding-left: 6px;"> {{ car[col.field]}}</span>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="prazo_medio_pag"
                      header="PRAZO MÉDIO PAG AVG PAYMENT PERIOD (Last 6 months)" [style]="{'width':'89px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="prazo_medio_pag" #v (ngModelChange)="filtrar(v.value,col.field,false,'equals')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">PRAZO MÉDIO PAG <br> AVG PAYMENT
                        PERIOD
                        <br>
                        (Last 6 months)
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="prazo_medio_atraso"
                      header="PRAZO MÉDIO ATRASO AVG PAYMENT DELAY (Last 6 months)" [style]="{'width':'90px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="prazo_medio_atraso" #v
                          (ngModelChange)="filtrar(v.value,col.field,false,'equals')" type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">PRAZO MÉDIO ATRASO<br>AVG PAYMENT
                        DELAY
                        <br>
                        (Last 6 months)
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="total_divida"
                      header="TOTAL DÍVIDA TOTAL DEBT" [style]="{'width':'70px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="total_divida" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">TOTAL EM CURSO<br>CURRENT
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: right; display: block; padding-right: 6px;"
                          [style.color]="( 0  > car[col.field])? 'red' : ''">{{car[col.field] | number: '1.2-2'}}
                          € </span>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="total_divida_venc"
                      header="TOTAL DÍVIDA VENC. TOTAL DEBT DUE" [style]="{'width':'93px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="total_divida_venc" #v
                          (ngModelChange)="filtrar(v.value,col.field,false,'contains')" type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">TOTAL VENCIDO<br>TOTAL DUE
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: right; display: block; padding-right: 6px;"
                          [style.color]="( 0  > car[col.field])? 'red' : ''">{{car[col.field] | number: '1.2-2'}}
                          € </span>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="nao_vencido"
                      header="NÃO VENCIDO TOTAL UNDUE" [style]="{'width':'73px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="nao_vencido" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">TOTAL NÃO VENCIDO <br>TOTAL UNDUE
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: right; display: block; padding-right: 6px;"
                          [style.color]="( 0  > car[col.field])? 'red' : ''">{{car[col.field] | number: '1.2-2'}}
                          € </span>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="menos_31_dias"
                      header="< 31 DIAS < 31 DAYS" [style]="{'width':'70px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="menos_31_dias" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">
                        0 a 30 DIAS <br>
                        0 to 30 DAYS</ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: right; display: block; padding-right: 6px;"
                          [style.color]="( 0  > car[col.field])? 'red' : ''">{{car[col.field] | number: '1.2-2'}}
                          € </span>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="entre_31_60"
                      header="31 A 60 DIAS 31 TO 60 DAYS" [style]="{'width':'70px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="entre_31_60" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">31 A 60 DIAS <br> 31 TO 60 DAYS
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: right; display: block; padding-right: 6px;"
                          [style.color]="( 0  > car[col.field])? 'red' : ''">{{car[col.field] | number: '1.2-2'}}
                          € </span>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="entre_62_90"
                      header="61 A 90 DIAS 61 TO 90 DAYS" [style]="{'width':'70px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="entre_62_90" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">61 A 90 DIAS <br> 61 TO 90 DAYS
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: right; display: block; padding-right: 6px;"
                          [style.color]="( 0  > car[col.field])? 'red' : ''">{{car[col.field] | number: '1.2-2'}}
                          € </span>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="maior_91_dias"
                      header="> 91 Dias > 91 Days" [style]="{'width':'70px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="maior_91_dias" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header">> 91 DIAS <br> > 91 DAYS</ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: right; display: block; padding-right: 6px;"
                          [style.color]="( 0  > car[col.field])? 'red' : ''">{{car[col.field] | number: '1.2-2'}}
                          € </span>
                      </ng-template>
                    </p-column>
                    <p-column [sortable]="true" [filter]="true" styleclass="text-danger" field="acordo"
                      header="ACORDO FINANCIAMENTO" [style]="{'width':'70px'}">
                      <ng-template pTemplate="filter" let-col>
                        <input class="ui-column-filter ui-inputtext ui-widget ui-state-default ui-corner-all"
                          [(ngModel)]="acordo" #v (ngModelChange)="filtrar(v.value,col.field,false,'contains')"
                          type="text">
                      </ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="header"> ACORDO <br>FINANCI.</ng-template>
                      <ng-template let-col let-car="rowData" pTemplate="body">
                        <span style="text-align: right; display: block; padding-right: 6px;"
                          [style.color]="( 0  > car[col.field])? 'red' : ''">{{car[col.field] | number: '1.2-2'}}
                          € </span>
                      </ng-template>
                    </p-column>

                  </p-dataTable>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<p-dialog header="Exportar para Excel" [responsive]="true" [positionTop]="0" [style]="{'max-height':'99vh'}"
  [width]="500" [dismissableMask]="true" appendTo="body" [closeOnEscape]="true" [draggable]="false"
  [(visible)]="displayEXPORT" [modal]="true">
  <form role="form" ngNativeValidate (ngSubmit)="downloadfile()">
    <!-- Modal Body -->
    <div class="modal-body">
      <div class="form-group col-md-12">
        <p-radioButton name="groupname" value="0" label="Lista Resumo" [(ngModel)]="lista_resumo"
          [ngModelOptions]="{standalone: true}"></p-radioButton>
      </div>
      <div class="form-group col-md-6">
        <p-radioButton name="groupname" value="1" label="Lista Detalhada por KAM" [(ngModel)]="lista_resumo"
          [ngModelOptions]="{standalone: true}"></p-radioButton>
      </div>
      <div class="form-group col-md-6">
        <p-dropdown appendTo="body" [filter]="true" [options]="kams"
          [style]="{'width':'200px','height':'25px','background':'white'}" [(ngModel)]="kam_selecionado"
          [ngModelOptions]="{standalone: true}">
        </p-dropdown>
      </div>
      <div class="form-group col-md-12">
        <p-radioButton name="groupname" value="2" label="Lista Detalhada Global" [(ngModel)]="lista_resumo"
          [ngModelOptions]="{standalone: true}"></p-radioButton>
      </div>
    </div>
    <!-- Modal Footer -->
    <div class="" style="text-align: -webkit-center;">
      <button type="button" class="btn btn-default" (click)="displayEXPORT = false">Fechar</button>
      <button type="submit" class="btn btn-success" [disabled]="disabled_bt">Export</button>
    </div>
  </form>
</p-dialog>


<button type="button" class="btn btn-danger btn-block" #inputerroficheiro [hidden]="true"
  onclick="demo.showNotification('top','right','ERRO!! Falha no Download!',4)"></button>